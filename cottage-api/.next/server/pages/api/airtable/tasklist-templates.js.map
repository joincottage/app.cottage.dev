{"version":3,"file":"../pages/api/airtable/tasklist-templates.js","mappings":";;;;;;;;;;AAAA;;;;;;;ACAA;;;;;;;ACAA;;;;;;;;;;;ACAyB;AAOV,eAAeC,mBAAmB,CAAC,CAAC,CAACC,SAAS,GAAEC,eAAe,EAAG,CAAE,GAAiB,CAAC,EAA4B,CAAC;IAChI,KAAK,CAACC,KAAI,GAAG,KAAK,CAAC,GAAG,CAACC,OAAO,EAASC,OAAO,EAAEC,MAAM,GAAK,CAAC;QAC1D,KAAK,CAACH,IAAI,GAAU,CAAC,CAAC;QACtBJ,0DAAI,CAACE,SAAS,EACXM,MAAM,CAAC,CAAC;YACPL,eAAe;YACfM,IAAI,EAAE,CAAW;QACnB,CAAC,EACAC,QAAQ,CACP,QAAQ,CAACC,IAAI,CAACC,OAAO,EAAEC,aAAa,EAAE,CAAC;YACrCD,OAAO,CAACE,OAAO,CAAC,QAAQ,CAAEC,MAAM,EAAE,CAAC;gBACjCX,IAAI,CAACY,IAAI,CAACD,MAAM,CAACE,MAAM;YACzB,CAAC;YAEDJ,aAAa;QACf,CAAC,EACD,QAAQ,CAACK,IAAI,CAACC,GAAG,EAAE,CAAC;YAClB,EAAE,EAAEA,GAAG,EAAE,CAAC;gBACRC,OAAO,CAACC,KAAK,CAACF,GAAG;gBACjBZ,MAAM,CAACY,GAAG;gBACV,MAAM;YACR,CAAC;YAEDb,OAAO,CAACF,IAAI;QACd,CAAC;IAEP,CAAC;IAED,MAAM,CAAC,CAAC;QAACA,IAAI,EAAJA,KAAI;IAAC,CAAC;AACjB,CAAC;;;;;;;;;;;;;;;ACpCD,MAAM,8BAA4B;;;ACAT;AAEzB,EAAiF;AAClE,eAAemB,YAAY,CAACC,GAAW,EAAE,CAAC;IACvD,KAAK,CAACC,QAAQ,GAAG,KAAK,CAACH,6BAAU,CAC/B,CAAwD,yDACxD,CAAC;QAACE,GAAG;IAAC,CAAC,EACP,CAAC;QAACG,OAAO,EAAE,CAAC;YAAC,CAAc,eAAE,CAAkB;QAAC,CAAC;IAAC,CAAC;IAGrD,MAAM,CAACF,QAAQ,CAACrB,IAAI;AACtB,CAAC;;;;;;;;;;;;;;;;;;;;ACT2D;AACrC;AAC4B;AACR;AACc;AACoB;eAE9D4B,OAAO,CACpBC,GAAmB,EACnBC,GAAoB,EACL,CAAC;IAChB,KAAK,CAACL,4EAAa,CAACI,GAAG,EAAEC,GAAG,EAAEN,2CAAI,CAACG,wEAAW;IAE9C,KAAK,CAACI,WAAW,GAAG,KAAK,CAACZ,sFAAY,CAACU,GAAG,CAACG,KAAK,CAACC,QAAQ;IACzD,EAAE,GAAGF,WAAW,EAAE,CAAC;QACjBD,GAAG,CAACI,MAAM,CAAC,GAAG,EAAEC,IAAI,CAAC,CAAc;QACnC,MAAM;IACR,CAAC;IAED,MAAM,CAAEN,GAAG,CAACO,MAAM;QAChB,IAAI,CAAC,CAAK;YAAE,CAAC;gBACX,KAAK,CAAC,CAAC,CAACpC,IAAI,EAAEqC,SAAS,EAAC,CAAC,GAAG,KAAK,CAACxC,gGAAmB,CAAC,CAAC;oBACrDC,SAAS,EAAE,CAAY;gBACzB,CAAC;gBAEDgC,GAAG,CAACQ,IAAI,CAACD,SAAS;gBAElB,KAAK;YACP,CAAC;;YACQ,CAAC;gBACRrB,OAAO,CAACC,KAAK,EACV,wBAAwB,EAAEY,GAAG,CAACO,MAAM,CAAC,kBAAkB,EAAEP,GAAG,CAACU,GAAG;gBAEnET,GAAG,CAACI,MAAM,CAAC,GAAG,EAAEM,GAAG;gBACnB,KAAK;YACP,CAAC;;AAEL,CAAC;AAED,iEAAed,0DAAU,CAACE,OAAO,CAAC,EAAC","sources":["webpack://cottage-api/external commonjs \"@sentry/nextjs\"","webpack://cottage-api/external commonjs \"airtable\"","webpack://cottage-api/external commonjs \"cors\"","webpack://cottage-api/./src/apiService/airtable/getDataFromAirtable.ts","webpack://cottage-api/external commonjs \"axios\"","webpack://cottage-api/./src/apiService/softr/validateUser.ts","webpack://cottage-api/./src/pages/api/airtable/tasklist-templates.ts"],"sourcesContent":["module.exports = require(\"@sentry/nextjs\");","module.exports = require(\"airtable\");","module.exports = require(\"cors\");","import base from './base';\n\ninterface RequiredParams {\n  tableName: string;\n  filterByFormula?: string;\n}\n\nexport default async function getDataFromAirtable({ tableName, filterByFormula = \"\" }: RequiredParams): Promise<{ data: any[] }> {\n  const data = await new Promise<any[]>((resolve, reject) => {\n    const data: any[] = [];\n    base(tableName)\n      .select({\n        filterByFormula,\n        view: \"Grid view\",\n      })\n      .eachPage(\n        function page(records, fetchNextPage) {\n          records.forEach(function (record) {\n            data.push(record.fields);\n          });\n\n          fetchNextPage();\n        },\n        function done(err) {\n          if (err) {\n            console.error(err);\n            reject(err);\n            return;\n          }\n\n          resolve(data);\n        }\n      );\n  });\n\n  return { data };\n}","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"axios\");","import axios from \"axios\";\n\n// https://docs.softr.io/my-account/api-settings#validate-an-authentication-token\nexport default async function validateUser(jwt: string) {\n  const response = await axios.post(\n    \"https://sequense.softr.app/v1/api/users/validate-token\",\n    { jwt },\n    { headers: { \"Content-Type\": \"application/json\" } }\n  );\n\n  return response.data;\n}\n","import { NextApiRequest, NextApiResponse } from \"next\";\nimport base from \"src/apiService/airtable/base\";\nimport validateUser from \"src/apiService/softr/validateUser\";\nimport cors from \"cors\";\nimport runMiddleware from \"src/utils/runMiddleware\";\nimport { withSentry } from \"@sentry/nextjs\";\nimport corsOptions from \"../../../apiService/corsOptions\";\nimport getDataFromAirtable from \"src/apiService/airtable/getDataFromAirtable\";\n\nasync function handler(\n  req: NextApiRequest,\n  res: NextApiResponse\n): Promise<void> {\n  await runMiddleware(req, res, cors(corsOptions));\n\n  const isValidUser = await validateUser(req.query.jwtToken as string);\n  if (!isValidUser) {\n    res.status(401).send(\"Unauthorized\");\n    return;\n  }\n\n  switch (req.method) {\n    case \"GET\": {\n      const { data: taskLists } = await getDataFromAirtable({\n        tableName: \"Task Lists\",\n      });\n\n      res.json(taskLists);\n\n      break;\n    }\n    default: {\n      console.error(\n        `Unsupported method type ${req.method} made to endpoint ${req.url}`\n      );\n      res.status(404).end();\n      break;\n    }\n  }\n}\n\nexport default withSentry(handler);\n"],"names":["base","getDataFromAirtable","tableName","filterByFormula","data","Promise","resolve","reject","select","view","eachPage","page","records","fetchNextPage","forEach","record","push","fields","done","err","console","error","axios","validateUser","jwt","response","post","headers","cors","runMiddleware","withSentry","corsOptions","handler","req","res","isValidUser","query","jwtToken","status","send","method","taskLists","json","url","end"],"sourceRoot":""}